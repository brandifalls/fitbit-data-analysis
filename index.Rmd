---
title: "fitbit_analysis_v3"
author: "Brandi Falls"
date: "6/29/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview of Project
Bellabeat is a high-tech manufacturer of health-focused products for women. Bellabeat is a successful small company, but they have the potential to become a larger player in the global smart device. Analyzing smart device fitness data could help unlock new growth opportunities for the company 
market. 

***

# Step 1 - Ask

## Business Task:
The business task is to analyze *Fitbit* smart device usage data in order to gain insight into how consumers currently use their smart devices and to discover underlying trends that can applied to *Bellabeat* products. This insight could help unlock new growth opportunities and the best marketing strategy to meet business growth goals. 

The ask entails focusing on only 1 of the below products to recommend a marketing strategy from insights gained. 

### Products
* Bellabeat app: The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products.
* Leaf: Bellabeat’s classic wellness tracker can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track activity, sleep, and stress.
* __Time__: This wellness watch combines the timeless look of a classic timepiece with smart technology to track user activity, sleep, and stress. The Time watch connects to the Bellabeat app to provide you with insights into your daily wellness.
* Spring: This is a water bottle that tracks daily water intake using smart technology to ensure that you are appropriately hydrated throughout the day. The Spring bottle connects to the Bellabeat app to track your hydration levels.
* Bellabeat membership: Bellabeat also offers a subscription-based membership program for users.Membership gives users 24/7 access to fully personalized guidance on nutrition, activity, sleep, health and beauty, and mindfulness based on their lifestyle and goals.


We will chose to focus on the __Time__ product for marketing.

## Stakeholders
* Urška Sršen: Bellabeat’s cofounder and Chief Creative Officer
* Sando Mur: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat Executive Team
* Bellabeat marketing analytics team: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.

## About the Company
* Founded in 2013
* By 2016, global offices and multiple products
* women-focused to empower women with knowledge about their own health and habits.
* Collecting data on activity, sleep, stress, and reproductive health has allowed Bellabeat to empower women with knowledge about their own health and habits.

## Current Marketing Strategy
* E-commerce on their website - https://bellabeat.com/
* Online retailers
* Traditional advertising media 
  +radio
  + out-of-home billboards
  + print
  + television
* Digital marketing
  + Google Search
  + Facebook, Instagram, Twitter
  + Youtube video ads
  + Google Display Network ads

***

# Step 2 - Prepare

## Description of the Dataset

We have used a public dataset that explores smart device users’ daily habits.

Name: FitBit Fitness Tracker Data (CC0 Public Domain)
Link: https://www.kaggle.com/arashnic/fitbit

"This Kaggle data set contains personal fitness tracker from thirty fitbit users. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users’ habits.

These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. "

## Limitations
* There are limited users. The sample size may not be representative of the population
* There are few categorical variables to categorize the data for analysis
* There is no data on male and female population. We will not be able to make female-specific observations for a female target audience. 
* Each dataset has 30 days of data from 4/12/2016 to 5/12/2016, but the dataset description indicates 03/12/2016 to 05/12/2016. We will have less data to work with which may impact recommendations. 
* The first day of data collected is Tuesday 4/12/2016, and the last day of data collected is on  Thursday 5/12/2016. There is an unbalanced spread of days, so any weekly analysis could be misleading.

## ROCCC Validation of Dataset
* Reliable - we will assume this data is accurate and reliable.
* Original - The data is original as it is 1st party data and directly gathered from users
* Comprehensive - The data is not comprehensive as it does not have all details needed for a full detailed analysis to meet the business goal
* Current - The data is not current as the data is from 2016.
* Cited - The data is cited. 

## Data Summary 

Overall, this data may not be appropriate for conducting a full detailed analysis to meet the goal of the business. However, we will move forward with the data to uncover any insights. 

Ideally, we would be having a sample size that is more representative of the whole population, at least 6 months of data from a more current year, and gendered data so that we can gain insight into the specific female habits.

## Data Sensitivity
This is public data. No data was identified as sensitive and therefore we will not need to have Data anonymization / De-identification and no encryption to store data

## Setup Environment with Packages
```{r install}
# install.packages("tidyverse")
# install.packages("skimr")
# install.packages("janitor")
# install.packages("dplyr")
# install.packages("readr")
# install.packages("plotly")
# install.packages("date")
# install.packages("ggplot2")
# install.packages("formattable")
#install.packages("gghighlight")

```

```{r load}
library(tidyverse)
library(readr)
library(skimr)
library(janitor)
library(dplyr)
library(plotly)
library(date)
library(lubridate)
library(ggplot2)
library("formattable")
library(gghighlight)
```

## Import Data
* The below datasets were determined to be most useful for the purpose of this analysis. All other available datasets will not be in scope.
  + dailyActivity (daily physical activity)
  + sleepDay (daily sleep activity)
  + weightLogInfo (daily weight log activity)

```{r}
dailyActivity <- read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
sleepDay <- read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
weightLogInfo <- read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```

## First Look
```{r}
glimpse(dailyActivity)
glimpse(sleepDay)
glimpse(weightLogInfo)
```

## Observations from First Look
* Column names need to be cleaned
* Common variables are ID and ActivityDate/ActivityDay. 
* Date variables are in format MM/DD/YYYY but are Character data type. 
* We will need to rename Day --> Date for consistency, and convert to Date field.
* LoggedActivitiesDistance has a lot of 0 values and are not consistent (0 vs.0.00). Assumption is that it is not required to log most activities, but some activities require manual entry. Users rely on automated tracking and will not automatically log. 
* file sleepDay should be renamed to dailySleep. SleepDay column should be renamed to ActivityDate and formatted to MM/DD/YYYY for consistency

***

# Step 3 - Process
```{r}
#rename dataframes for easy reference 
#clean variable names for consistency
updated_daily_activity <- clean_names(dailyActivity)
updated_daily_sleep <- clean_names(sleepDay)
updated_weight_log <- clean_names(weightLogInfo)

#check for missing data (NA/null). results should be 0.

sum(is.na(updated_daily_activity))
#updated_weight_log has NA data, but we will retain it for integrity.
sum(is.na(updated_weight_log))
sum(is.na(updated_daily_sleep))
sum(is.null(updated_daily_activity))
sum(is.null(updated_weight_log))
sum(is.null(updated_daily_sleep))

#check for duplicated data. results should be 0.
sum(duplicated(updated_daily_activity))
sum(duplicated(updated_weight_log))
sum(duplicated(updated_daily_sleep))

#store and remove duplicates from updated_daily_sleep
sleep_records_dups <- updated_daily_sleep[duplicated(updated_daily_sleep), ]
updated_daily_sleep <- updated_daily_sleep[!duplicated(updated_daily_sleep), ]

#renamed Date variable for consistency and joining
updated_daily_sleep <- rename(updated_daily_sleep,activity_date=sleep_day)
updated_weight_log <- rename(updated_weight_log,activity_date=date) 
  
#convert all Date variables from Character to Date by adding casted_date variable
updated_daily_sleep$casted_date <- as.Date(mdy_hms(updated_daily_sleep$activity_date))
updated_daily_activity$casted_date <- as.Date(mdy(updated_daily_activity$activity_date))
updated_weight_log$casted_date <- as.Date(mdy_hms(updated_weight_log$activity_date))

#arrange by date
updated_daily_sleep %>% arrange(casted_date)
updated_daily_activity %>% arrange(casted_date)
updated_weight_log %>% arrange(casted_date)

#convert id from num to char
updated_daily_activity$id <- as.character(updated_daily_activity$id)
updated_daily_sleep$id <- as.character(updated_daily_sleep$id)
updated_weight_log$id <- as.character(updated_weight_log$id)

#adding Week Day column for categorical data
updated_daily_sleep$day <- weekdays(as.Date(updated_daily_sleep$casted_date)) 
updated_daily_activity$day <- weekdays(as.Date(updated_daily_activity$casted_date))
updated_weight_log$day <- weekdays(as.Date(updated_weight_log$casted_date))

#adding report type column for categorical data
updated_weight_log$report_type <- ifelse(updated_weight_log$is_manual_report == TRUE, "Manual", "Automated")


#dailyCalories, dailyIntensities, and dailySteps provide no additional value as all data is already merged in DailyActivty, as observed by the set difference analysis 

#Comparison of dataframes
dailyCalories <- clean_names(read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv"))
dailyIntensities <- clean_names(read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/dailyIntensities_merged.csv"))
dailySteps <- clean_names(read_csv("C:/Users/Brandi/Documents/Bellabeat Case Study/fitbit/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv"))

calorie_comparison_test <- updated_daily_activity %>% 
  select(id,activity_date,calories)

intensity_comparison_test <- updated_daily_activity %>% 
  select(id,activity_date,sedentary_minutes,lightly_active_minutes, fairly_active_minutes,very_active_minutes,sedentary_active_distance,light_active_distance,moderately_active_distance,very_active_distance)

daily_steps_comparison_test <- updated_daily_activity %>% 
  select(id,activity_date,total_steps)

a1 <- rename(dailyCalories,activity_date=activity_day) %>% 
  select(id,activity_date,calories) 

a2 <- rename(dailyIntensities,activity_date=activity_day) %>% 
  select(id,activity_date,sedentary_minutes,lightly_active_minutes, fairly_active_minutes,very_active_minutes,sedentary_active_distance,light_active_distance,moderately_active_distance,very_active_distance)

a3 <- rename(dailySteps,activity_date=activity_day, total_steps=step_total) %>% 
  select(id,activity_date,total_steps)

a1$id <- as.character(a1$id)
a2$id <- as.character(a2$id)
a3$id <- as.character(a3$id)

setdiff(calorie_comparison_test,a1)
setdiff(intensity_comparison_test,a2)
setdiff(daily_steps_comparison_test,a3)

```

***

# Step 4 - Analyze
```{r}
#quick view of cleaned data
glimpse(updated_daily_activity)
glimpse(updated_daily_sleep)
glimpse(updated_weight_log)

#unique participants in each dataframe
n_distinct(updated_daily_activity$id)
n_distinct(updated_daily_sleep$id)
n_distinct(updated_weight_log$id)

#Examining Date Ranges. All date ranges are the same
min(updated_daily_activity$casted_date)
min(updated_daily_sleep$casted_date)
min(updated_weight_log$casted_date)
max(updated_daily_activity$casted_date)
max(updated_daily_sleep$casted_date)
max(updated_weight_log$casted_date)

#all have 30 days of data
difftime(max(updated_daily_activity$casted_date),min(updated_daily_activity$casted_date), units="days")
difftime(max(updated_daily_sleep$casted_date),min(updated_daily_sleep$casted_date), units="days")
difftime(max(updated_weight_log$casted_date),min(updated_weight_log$casted_date), units="days")

#merge daily activity + daily sleep outer join
combined_sleep_activity <- merge(updated_daily_sleep, updated_daily_activity, by = c("id", "casted_date" ), all.y = TRUE)
n_distinct(combined_sleep_activity$id)

#merge all daily data outer join
combined_all_daily <- merge(combined_sleep_activity, updated_weight_log, by = c("id", "casted_date"),all.x = TRUE)
n_distinct(combined_all_daily$id)

#ordering days for graph visualizations
updated_daily_sleep$day <- factor(updated_daily_sleep$day,levels =
                                    c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
updated_daily_activity$day <- factor(updated_daily_activity$day,levels = 
                                       c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))
updated_weight_log$day <- factor(updated_weight_log$day,levels = 
                                   c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

#Quick summary statistics
updated_daily_activity %>%
  select(total_steps,
         total_distance,
         sedentary_minutes) %>%
  summary()

updated_daily_sleep %>%  
  select(total_sleep_records,
         total_minutes_asleep,
         total_time_in_bed) %>%
  summary()

updated_weight_log %>%  
  select(weight_pounds,
         bmi,
         fat,
         is_manual_report) %>%
  summary()

updated_daily_activity %>% 
  select(total_distance,
         very_active_distance,
         moderately_active_distance,
         light_active_distance,
         sedentary_active_distance) %>%
  summary()


#percent of total records of 0 logged activities
  ((updated_daily_activity %>% filter(logged_activities_distance  == 0) %>% count()) / nrow(updated_daily_activity)) %>% percent()


#percent of total records with 0 steps
  ((updated_daily_activity %>% filter(total_steps == 0) %>% count()) / nrow(updated_daily_activity)) %>% percent()

#percent of total records with 0 distance
((updated_daily_activity %>% filter(total_distance == 0) %>% count()) / nrow(updated_daily_activity)) %>% percent()

#percent of total users who participated in weight logging
(n_distinct(updated_weight_log$id) / n_distinct(updated_daily_activity$id)) %>% percent()

#percent of total users who participated in sleep logging
(n_distinct(updated_daily_sleep$id) / n_distinct(updated_daily_activity$id)) %>% percent()


```

***

# Step 5 - Share
## Visualizations
### Total Daily Graphs
```{r}
#Total Steps per day
ggplot(updated_daily_activity, aes(x=day, y=total_steps)) + 
  geom_bar(stat="identity", fill='steelblue') +
  labs(title="Daily Steps", x= "Day of the Week", y="Total Steps")

#Total Calories per day
ggplot(updated_daily_activity, aes(x=day, y=calories)) + 
  geom_bar(stat="identity", fill='steelblue') +
  labs(title="Daily Calories", x= "Day of the Week", y="Total Calories") 

#Total Sleep per day
ggplot(updated_daily_sleep, aes(x=day, y=total_minutes_asleep)) + 
  geom_bar(stat="identity", fill='steelblue') +
  labs(title="Daily Sleep", x= "Day of the Week", y="Total Sleep Minutes") 

#Total Weight Logs per day
ggplot(updated_weight_log, aes(x=day)) + 
  geom_bar(fill='steelblue') +
  labs(title="Daily Weight Logs", x= "Day of the Week", y="Total Log Count") 





```

### Weight Log Graphs
```{r}
#Total manual vs automatic weight logs
#recommendation to market more automated reports
ggplot(updated_weight_log, aes(report_type)) + 
  geom_bar(fill='steelblue') +
  labs(title="Manual vs Automated Weight Logs", x="", y="Total Log Count") 

#shows user participation frequency. 2 users had most of the records
ggplot(updated_weight_log, aes(x=id)) + 
  geom_bar(fill='steelblue') +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(title="Weight Log Participation", x="", y="Total Log Count") 

#Shows participants log days. random days. not consistent
ggplot(updated_weight_log, aes(x=casted_date, y=id)) + 
  geom_point() +
  labs(title="Weight Log Consistency", x="Date of Log", y="User ID") 

#weight change per participant. shows no changes in weight
ggplot(updated_weight_log, aes(x=casted_date, y=weight_pounds)) + 
  geom_line(color="blue") +
  facet_wrap(~id) +
  labs(title="Weight Change", x="", y="Weight in Pounds") 

```

### Trend Lines
```{r}
#relationship between total_time_in_bed and total_minutes_asleep
ggplot(data=updated_daily_sleep, aes(x=total_time_in_bed, y= total_minutes_asleep)) + 
  geom_point() +
  stat_smooth(method="lm", se=FALSE) +
  labs(title="Time in Bed vs Time Asleep", x="In Bed", y="Asleep") 

#relationship between total_steps and sedentary_minutes
ggplot(data=updated_daily_activity, aes(x=total_steps, y=sedentary_minutes)) +
  geom_point() +
  stat_smooth(method="lm", se=FALSE) +
  labs(title="Steps vs Sedentary Minutes", x="Total Steps", y="Sedentary Minutes")

#total steps vs total minutes asleep
ggplot(combined_sleep_activity, aes(x=total_minutes_asleep,  y=total_steps)) + 
  geom_point() +
  geom_vline(xintercept = 420 , color="green") +
  geom_vline(xintercept = 540 , color="green") +
  stat_smooth(method="lm", se=FALSE) +
  labs(title="Steps vs Sleep", x="Minutes Asleep", y="Total Steps" ) +
  annotate("text", x = 675, y = 15000, label = "7-9 hour recommended", color="green")

#total minutes asleep vs calories
ggplot(combined_sleep_activity, aes(x=total_minutes_asleep,  y=calories)) + 
  geom_point() +
  geom_vline(xintercept = 420 , color="green") +
  geom_vline(xintercept = 540 , color="green") +
  stat_smooth(method="lm", se=FALSE) +
  labs(title="Sleep vs Calories", x="Minutes Asleep", y="Calories") +
  annotate("text", x = 675, y = 4000, label = "7-9 hour recommended", color="green")
```

### Participation
```{r}
#how often participants participate. inconsistent participation
ggplot(updated_daily_activity, aes(x=id)) + 
  geom_bar(fill='steelblue') +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(title="Physical Activity Participant Frequency", x="User ID", y="Total Log Count") 

ggplot(updated_daily_sleep, aes(x=id)) + 
  geom_bar(fill='steelblue') +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(title="Sleep Participant Frequency", x="User ID", y="Total Log Count") 

ggplot(updated_weight_log, aes(x=id)) + 
  geom_bar(fill='steelblue') +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(title="Weight Log Particpant Frequency", x="User ID", y="Total Log Count") 

record_type <- c("Daily Activity", "Daily Sleep", "Daily Weight Log")
distinct_user_count <-c(n_distinct(updated_daily_activity$id), n_distinct(updated_daily_sleep$id), n_distinct(updated_weight_log$id))

user_comparison <- data.frame(record_type,distinct_user_count)

ggplot(user_comparison, aes(record_type,distinct_user_count)) +
  geom_bar(stat="identity", fill='steelblue') +
  labs(title="All Participation Activity", x="Type of Data", y="Total Log Count") 

#Total Participants for Each
# Observations:
# *Activity is the easiest to log. May be the easiest to remember
# *Users may not like wearing the device to sleep


```

### Steps over time
```{r}

#Highlighting 2 users with over 25000 steps for visual
ggplot(updated_daily_activity, aes(x=activity_date, y=total_steps, group=id, color=id)) +
  geom_line() +
  theme(axis.text.x = element_text(angle = 90)) +
  gghighlight(max(total_steps) > 25000) +
  labs(title="User Activitiy", x="Date", y="Steps Taken")


```

## Observations

### Participation 
* Users were inconsistent in tracking across all activities
* 33 participants for physical activity
* 24 participants for sleep activity
* 8 participants for weight logging activity

### Weekday Analysis
* Mid-week is most active for physical and sleep activity
* Tuesday is the most active day for total steps taken and Calories burned
  + Sunday is the least active
* Wednesday is the day with most sleep minutes recorded
  + Monday is the least
* Monday and Wednesday are the most active days for Weight Log recording
  + Friday and Saturday are the least active days

### Weight Log Analysis
* There are more manual logs than automated logs for logging weight
  + This could mean users do not have access to a scale that connects to Fitbit products
* 2 of 8 participants accounted for most of the logs, and the same 2 were most consistent in logging nearly everyday
* The remaining 6 participants were not consistent and randomly logged. 
* There were no drastic changes in weight. The study being only 30 days may account for this.

### Daily Sleep
* Most participants spend roughly the same amount of time in bed and being asleep
* There are some users that stay awake longer in bed before falling asleep 

### Daily Physical Activity
* As total steps increases, the amount of sedentary minutes decreases, as one may assume. 

### Coorelation between Physical and Sleep Activity
* There is a trend showing the more sleep you get, the less steps you take. 
  + This could mean that there is less time to be active if you sleep longer
* There is not a strong correlation between the amount of sleep and the amount of calories burned. 

## Ideas
* what days of the week are least and most active. make challenge for those days
* logged activities - what is not automatically tracked?
* recommendation to have more categorical data to collect i.e. activity types walking, running, swimming
* what are the goals of participant

***

# Step 6 - Act

## Final Conclusions
* Overall, users were not consistent with tracking physical activity, sleep activity, and logging weight.
Potential reasons:
  + Users were forgetting to wear the device during physical activity and during sleep
  + Users were not wanting to wear the device due to comfortability
  + Users were forgetting to manually log activity
  + Users were not finding the tracking process easy and convenient
* Users were more consistent with tracking physical activities, which could indicate that the device is not comfortable enough to wear during sleep, and that the device does not allow easy weight logging entries.
* 96% of logged physical activity records are automated. Meaning users rely on activity being automatically detected and logged, and not manually entered. 

## Recommendations
To meet the goal to empower women with knowledge about their own health and habits, the following recommendations for marketing are to:

#### Create and Advertise 
* A more comfortable Time device that allows all-day wear for consistent tracking which leads to more complete health data 
* Daily challenges to provide incentive to stay consistent with all activities - physical, sleep, and logging each day of the week
* An easy and convenient tracking process focused on automated activity tracking, and less need for manual intervention. 
* Reminders to log activity that cannot be automatically gathered - 
reproductive health, weight, stress

## Next Steps
* More forward with recommendations with the insights gained from the limited data
* Expand upon the limited data and timeframe by conducting another  survey to gather specific and categorical data that targets the femail audience
